<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebSocket+TLS+Web | V2Ray Beginner&#39;s Guide</title>
    <meta name="description" content="Step-by-step guide for first-timers&#39; using V2Ray.">
    
    
    <link rel="preload" href="/assets/css/0.styles.7bc838ba.css" as="style"><link rel="preload" href="/assets/js/app.22d48a08.js" as="script"><link rel="preload" href="/assets/js/2.2b0139c3.js" as="script"><link rel="preload" href="/assets/js/59.e70edc29.js" as="script"><link rel="prefetch" href="/assets/js/10.d595958a.js"><link rel="prefetch" href="/assets/js/11.09e72945.js"><link rel="prefetch" href="/assets/js/12.53a95f5c.js"><link rel="prefetch" href="/assets/js/13.c8ac9cf4.js"><link rel="prefetch" href="/assets/js/14.7fe6d8f3.js"><link rel="prefetch" href="/assets/js/15.2b1f0b1c.js"><link rel="prefetch" href="/assets/js/16.dc5a86fa.js"><link rel="prefetch" href="/assets/js/17.2c18ccf1.js"><link rel="prefetch" href="/assets/js/18.574b4a0a.js"><link rel="prefetch" href="/assets/js/19.cfa66c61.js"><link rel="prefetch" href="/assets/js/20.532f69fb.js"><link rel="prefetch" href="/assets/js/21.7dd37302.js"><link rel="prefetch" href="/assets/js/22.49aea0be.js"><link rel="prefetch" href="/assets/js/23.1a6709ec.js"><link rel="prefetch" href="/assets/js/24.2aa7679a.js"><link rel="prefetch" href="/assets/js/25.a04350ed.js"><link rel="prefetch" href="/assets/js/26.88b3be16.js"><link rel="prefetch" href="/assets/js/27.b2974b8f.js"><link rel="prefetch" href="/assets/js/28.e976027c.js"><link rel="prefetch" href="/assets/js/29.de5535d9.js"><link rel="prefetch" href="/assets/js/3.0505df1b.js"><link rel="prefetch" href="/assets/js/30.4b8d9e47.js"><link rel="prefetch" href="/assets/js/31.01d9ebba.js"><link rel="prefetch" href="/assets/js/32.13a08859.js"><link rel="prefetch" href="/assets/js/33.4dc12e11.js"><link rel="prefetch" href="/assets/js/34.b1dc8e7e.js"><link rel="prefetch" href="/assets/js/35.0ce8daa0.js"><link rel="prefetch" href="/assets/js/36.3c0e21c4.js"><link rel="prefetch" href="/assets/js/37.c603e5e3.js"><link rel="prefetch" href="/assets/js/38.b898469c.js"><link rel="prefetch" href="/assets/js/39.9e327a04.js"><link rel="prefetch" href="/assets/js/4.0303d2dc.js"><link rel="prefetch" href="/assets/js/40.ec458719.js"><link rel="prefetch" href="/assets/js/41.ae22a32f.js"><link rel="prefetch" href="/assets/js/42.9147dbfd.js"><link rel="prefetch" href="/assets/js/43.d2066fa5.js"><link rel="prefetch" href="/assets/js/44.6978a2b4.js"><link rel="prefetch" href="/assets/js/45.eba82024.js"><link rel="prefetch" href="/assets/js/46.360a9dca.js"><link rel="prefetch" href="/assets/js/47.9e4a5d8a.js"><link rel="prefetch" href="/assets/js/48.84d0a58c.js"><link rel="prefetch" href="/assets/js/49.013916fb.js"><link rel="prefetch" href="/assets/js/5.1c8f5e26.js"><link rel="prefetch" href="/assets/js/50.84b68d56.js"><link rel="prefetch" href="/assets/js/51.e739532f.js"><link rel="prefetch" href="/assets/js/52.4eea060b.js"><link rel="prefetch" href="/assets/js/53.dee8a50e.js"><link rel="prefetch" href="/assets/js/54.d42eecb1.js"><link rel="prefetch" href="/assets/js/55.ddc9172b.js"><link rel="prefetch" href="/assets/js/56.62c0c610.js"><link rel="prefetch" href="/assets/js/57.0e9df061.js"><link rel="prefetch" href="/assets/js/58.11df506f.js"><link rel="prefetch" href="/assets/js/6.ec98a1eb.js"><link rel="prefetch" href="/assets/js/60.b2128606.js"><link rel="prefetch" href="/assets/js/61.fd2f0f4f.js"><link rel="prefetch" href="/assets/js/62.e7c3d6e8.js"><link rel="prefetch" href="/assets/js/63.46738674.js"><link rel="prefetch" href="/assets/js/64.99e463b5.js"><link rel="prefetch" href="/assets/js/65.c288fd67.js"><link rel="prefetch" href="/assets/js/66.a3cd1041.js"><link rel="prefetch" href="/assets/js/67.dd3708cb.js"><link rel="prefetch" href="/assets/js/68.bd5e97b5.js"><link rel="prefetch" href="/assets/js/69.77279da0.js"><link rel="prefetch" href="/assets/js/7.9a6ca72a.js"><link rel="prefetch" href="/assets/js/70.3a0def1b.js"><link rel="prefetch" href="/assets/js/71.3b11700a.js"><link rel="prefetch" href="/assets/js/72.3398475a.js"><link rel="prefetch" href="/assets/js/73.7ad51f92.js"><link rel="prefetch" href="/assets/js/74.dae46034.js"><link rel="prefetch" href="/assets/js/75.b4b2a570.js"><link rel="prefetch" href="/assets/js/76.b580fa65.js"><link rel="prefetch" href="/assets/js/77.a34a4e4d.js"><link rel="prefetch" href="/assets/js/78.8b9b6bfd.js"><link rel="prefetch" href="/assets/js/79.1807b576.js"><link rel="prefetch" href="/assets/js/8.b10b2cf2.js"><link rel="prefetch" href="/assets/js/80.961d64ed.js"><link rel="prefetch" href="/assets/js/81.6f71829f.js"><link rel="prefetch" href="/assets/js/82.2078f524.js"><link rel="prefetch" href="/assets/js/83.73e4c9b0.js"><link rel="prefetch" href="/assets/js/84.5cb9aef6.js"><link rel="prefetch" href="/assets/js/85.9ce40f84.js"><link rel="prefetch" href="/assets/js/86.1cb9e21d.js"><link rel="prefetch" href="/assets/js/87.eea4871b.js"><link rel="prefetch" href="/assets/js/88.bde2fd29.js"><link rel="prefetch" href="/assets/js/89.5f8ced78.js"><link rel="prefetch" href="/assets/js/9.80136a4e.js"><link rel="prefetch" href="/assets/js/90.da5327e8.js"><link rel="prefetch" href="/assets/js/91.a8827639.js"><link rel="prefetch" href="/assets/js/92.621155d1.js"><link rel="prefetch" href="/assets/js/93.459f430d.js"><link rel="prefetch" href="/assets/js/94.bc35cc7c.js"><link rel="prefetch" href="/assets/js/95.ef22538d.js"><link rel="prefetch" href="/assets/js/96.9dbadca8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7bc838ba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en_US/" class="home-link router-link-active"><!----> <span class="site-name">V2Ray Beginner's Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://v2fly.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official Guide
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/wss_and_web.html" class="nav-link">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/en_US/advanced/wss_and_web.html" class="nav-link router-link-exact-active router-link-active">en-US</a></li><li class="dropdown-item"><!----> <a href="/fa/" class="nav-link">fa-IR</a></li><li class="dropdown-item"><!----> <a href="/ko_KR/" class="nav-link">ko-KR</a></li><li class="dropdown-item"><!----> <a href="/ru_RU/" class="nav-link">ru-RU</a></li><li class="dropdown-item"><!----> <a href="/vi_VN/" class="nav-link">vi-VN</a></li><li class="dropdown-item"><!----> <a href="/fr_FR/" class="nav-link">fr-FR</a></li></ul></div></div> <a href="https://github.com/v2fly/v2ray-step-by-step" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://v2fly.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official Guide
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/wss_and_web.html" class="nav-link">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/en_US/advanced/wss_and_web.html" class="nav-link router-link-exact-active router-link-active">en-US</a></li><li class="dropdown-item"><!----> <a href="/fa/" class="nav-link">fa-IR</a></li><li class="dropdown-item"><!----> <a href="/ko_KR/" class="nav-link">ko-KR</a></li><li class="dropdown-item"><!----> <a href="/ru_RU/" class="nav-link">ru-RU</a></li><li class="dropdown-item"><!----> <a href="/vi_VN/" class="nav-link">vi-VN</a></li><li class="dropdown-item"><!----> <a href="/fr_FR/" class="nav-link">fr-FR</a></li></ul></div></div> <a href="https://github.com/v2fly/v2ray-step-by-step" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Preface</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/" class="sidebar-link">Guide to V2Ray configuration</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/prep/prep" class="sidebar-heading clickable"><span>Before start</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/basics/basics" class="sidebar-heading clickable"><span>Basics</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/advanced/advanced" class="sidebar-heading clickable open"><span>Advanced</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/advanced/mux.html" class="sidebar-link">Mux</a></li><li><a href="/en_US/advanced/mkcp.html" class="sidebar-link">mKCP</a></li><li><a href="/en_US/advanced/dynamicport.html" class="sidebar-link">Dynamic Port</a></li><li><a href="/en_US/advanced/outboundproxy.html" class="sidebar-link">Proxy Forwarding</a></li><li><a href="/en_US/advanced/httpfake.html" class="sidebar-link">HTTP Obfuscation</a></li><li><a href="/en_US/advanced/tls.html" class="sidebar-link">TLS</a></li><li><a href="/en_US/advanced/websocket.html" class="sidebar-link">WebSocket</a></li><li><a href="/en_US/advanced/wss_and_web.html" class="active sidebar-link">WebSocket+TLS+Web</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/advanced/wss_and_web.html#configuration-example" class="sidebar-link">Configuration Example</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/advanced/wss_and_web.html#server-side-configuration" class="sidebar-link">Server-side Configuration</a></li><li class="sidebar-sub-header"><a href="/en_US/advanced/wss_and_web.html#client-side-configuration" class="sidebar-link">Client-side Configuration</a></li><li class="sidebar-sub-header"><a href="/en_US/advanced/wss_and_web.html#note" class="sidebar-link">Note</a></li><li class="sidebar-sub-header"><a href="/en_US/advanced/wss_and_web.html#other-notices" class="sidebar-link">Other Notices</a></li></ul></li></ul></li><li><a href="/en_US/advanced/h2.html" class="sidebar-link">HTTP/2</a></li><li><a href="/en_US/advanced/cdn.html" class="sidebar-link">CDN</a></li><li><a href="/en_US/advanced/traffic.html" class="sidebar-link">Traffic Statistics</a></li><li><a href="/en_US/advanced/not_recommend.html" class="sidebar-link">Not recommended configurations</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/app/app" class="sidebar-heading clickable"><span>Practical</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/routing/routing" class="sidebar-heading clickable"><span>Routing</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="websocket-tls-web"><a href="#websocket-tls-web" aria-hidden="true" class="header-anchor">#</a> WebSocket+TLS+Web</h1> <p>In the previous section, we give the instruction of the configuration for TLS and WebSocket respectively. In this section, we will work with web servers and apply both TLS and WebSocket. Three examples of web servers are given here, including Nginx, Caddy and Apache. You can choose one of them, or you can use other web servers as you like.</p> <p>Many newcomers want to config in WebSocket+TLS+Web or WebSocket+TLS+Web+CDN on their first time using V2Ray, while some of them are making so big a step that they do not even understand the difference between ssh and bash. Some users chose to use Nginx / Caddy / Apache because their environment already had Nginx / Caddy / Apache which can utilize V2Ray as a back-end. Using WebSocket because Nginx / Caddy / Apache can only use WebSocket and use TLS because it can be encrypted, it obfuscates traffic like HTTPS. Maybe the configuration combination of WebSocket+TLS+Web is relatively good, but it doesn't mean that this configuration is suitable for everyone. Because this section covers Nginx / Caddy / Apache, but only the configuration examples are given without specific usage. Which means you need to understand one of these three software before try to configure them working with V2Ray together. If you don't know how to configure them, it is suggested that you learn them prior.</p> <p>Note: V2Ray's Websocket+TLS configuration combination does not depend on Nginx / Caddy / Apache, instead, it works standalone.</p> <h2 id="configuration-example"><a href="#configuration-example" aria-hidden="true" class="header-anchor">#</a> Configuration Example</h2> <h3 id="server-side-configuration"><a href="#server-side-configuration" aria-hidden="true" class="header-anchor">#</a> Server-side Configuration</h3> <p>For this case, TLS traffic will be handled by the Nginx / Caddy / Apache, so we need to configure them to enable TLS. Although it is not necessarily to setting your webserver to listen to 443 port, it is recommended, as it is the standard port of HTTPS. Then the traffic will be forwarded to intranet port that V2Ray's WebSocket is listening on (in this case it is 10000), V2Ray server side does not need to configure TLS.</p> <h4 id="v2ray-server-side-configuration"><a href="#v2ray-server-side-configuration" aria-hidden="true" class="header-anchor">#</a> v2ray Server-side Configuration</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;listen&quot;</span><span class="token operator">:</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token comment">// Only listen to local host 127.0.0.1, avioding other external inspection to 10000 port </span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vmess&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;clients&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;alterId&quot;</span><span class="token operator">:</span> <span class="token number">64</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ws&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;wsSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/ray&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;freedom&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="nginx-configuration"><a href="#nginx-configuration" aria-hidden="true" class="header-anchor">#</a> Nginx Configuration</h4> <p>The domain and certificate in the following configuration is an example from &quot;TLS&quot; section. Please replace with yours.</p> <div class="language- extra-class"><pre class="language-text"><code>server {
  listen 443 ssl;
  ssl on;
  ssl_certificate       /etc/v2ray/v2ray.crt;
  ssl_certificate_key   /etc/v2ray/v2ray.key;
  ssl_protocols         TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers           HIGH:!aNULL:!MD5;
  server_name           mydomain.me;
    location /ray { # Consistent with the path of V2Ray configuration
      if ($http_upgrade != &quot;websocket&quot;) { # Return 404 error when WebSocket upgrading negotiate failed
          return 404;
      }
      proxy_redirect off;
      proxy_pass http://127.0.0.1:10000; # Assume WebSocket is listening at localhost on port of 10000
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection &quot;upgrade&quot;;
      proxy_set_header Host $host;
      # Show real IP in v2ray access.log
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
</code></pre></div><h4 id="caddy-configuration"><a href="#caddy-configuration" aria-hidden="true" class="header-anchor">#</a> Caddy Configuration</h4> <p>There's no need to indicate certificates and keys for Caddy since it will issue and renew a certificate automatically.</p> <div class="language- extra-class"><pre class="language-text"><code>mydomain.me
{
  log ./caddy.log
  proxy /ray localhost:10000 {
    websocket
    header_upstream -Origin
  }
}
</code></pre></div><h4 id="apache-configuration"><a href="#apache-configuration" aria-hidden="true" class="header-anchor">#</a> Apache Configuration</h4> <p>Similarly, the configuration uses the domain name and certificate from the TLS section, please replace it with your own.</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;VirtualHost *:443&gt;
  ServerName mydomain.me
  SSLCertificateFile /etc/v2ray/v2ray.crt
  SSLCertificateKeyFile /etc/v2ray/v2ray.key

  SSLProtocol -All +TLSv1 +TLSv1.1 +TLSv1.2
  SSLCipherSuite HIGH:!aNULL

  &lt;Location &quot;/ray/&quot;&gt;
    ProxyPass ws://127.0.0.1:10000/ray/ upgrade=WebSocket
    ProxyAddHeaders Off
    ProxyPreserveHost On
    RequestHeader append X-Forwarded-For %{REMOTE_ADDR}s
  &lt;/Location&gt;
&lt;/VirtualHost&gt;
</code></pre></div><h3 id="client-side-configuration"><a href="#client-side-configuration" aria-hidden="true" class="header-anchor">#</a> Client-side Configuration</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
      <span class="token property">&quot;listen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;socks&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sniffing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;destOverride&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tls&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;auth&quot;</span><span class="token operator">:</span> <span class="token string">&quot;noauth&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;udp&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vmess&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;vnext&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mydomain.me&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
            <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;alterId&quot;</span><span class="token operator">:</span> <span class="token number">64</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ws&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tls&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;wsSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/ray&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="note"><a href="#note" aria-hidden="true" class="header-anchor">#</a> Note</h3> <ul><li>Note that: V2Ray supports TLS1.3 since 4.18.1. If you enable and force TLS1.3, please check the v2ray client version.</li> <li>Lower version of nginx may need the &quot;location&quot; parameter configured to &quot;/ray/&quot; to work properly.</li> <li>If it can't be used successfully after the setup is complete, it may be due to the SElinux  (if you are a CentOS 7 user, please pay special attention to the SElinux) to prevent Nginx from forwarding the data to the intranet. If this is the case, there will be no access records in the V2Ray log. A large number of &quot;Permission Denied&quot; records will prompt in the Nginx log. To solve this problem, execute the following commands in the terminal:<div class="language- extra-class"><pre class="language-text"><code>setsebool -P httpd_can_network_connect 1
</code></pre></div></li> <li>Please keep the server and client wsSettings strictly consistent. For V2Ray, <code>/ray</code> and <code>/ray/</code> are different.</li></ul> <h3 id="other-notices"><a href="#other-notices" aria-hidden="true" class="header-anchor">#</a> Other Notices</h3> <ol><li>The path parameter is encrypted with TLS enabled so there's no chance for GFW to see it.</li> <li>When proactively inspecting a path, got returned bad request cannot prove it is V2Ray;</li> <li>The unsafe factor is user. You need to think about your own insufficiency first. Even if the path in the example is a UUID, there are still many people COPYING AND PASTING;</li> <li>Using Header to enable forwarding is not safer than the path, don't be superstitious.</li></ol> <hr> <h4 id="updates"><a href="#updates" aria-hidden="true" class="header-anchor">#</a> Updates</h4> <ul><li>2017-12-05 More tips of common mistakes</li> <li>2018-01-03 Update</li> <li>2018-08-19 Update</li> <li>2018-08-30 Add configuration for Apache2</li> <li>2018-11-17 Adapted for V4.0+</li> <li>2019-7-5   TLS 1.3 notice</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/5/2019, 8:51:14 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en_US/advanced/websocket.html" class="prev">WebSocket</a></span> <span class="next"><a href="/en_US/advanced/h2.html">HTTP/2</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.22d48a08.js" defer></script><script src="/assets/js/2.2b0139c3.js" defer></script><script src="/assets/js/59.e70edc29.js" defer></script>
  </body>
</html>
